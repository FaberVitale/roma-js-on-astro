---
import '../styles/layouts/blogPost.scss';
import { Navbar } from '@components/Navbar/Navbar';
import { changeLanguage } from 'i18next';
import { getCanonicalURL, navbarLinks } from 'utils/routing';
import { BlogPostInfo } from '@components/BlogPostInfo/BlogPostInfo';
import { SocialLinksList } from '@components/SocialLinksList/SocialLinksList';
import { SlantedHeader } from '@components/SlantedHeader/SlantedHeader';
import { BlogPostComments } from '@components/BlogPostComments/BlogPostComments';
import { Lang } from '@i18n/types';
import { getNavbarMessages } from '@components/Navbar/helpers';
import HtmlDocument from '@components/HtmlDocument.astro';

const { content } = Astro.props;

const { title, description, createdAt = '', categories = [] } = content;
const canonicalURL = getCanonicalURL(Astro);

const relativePageUrl =
  canonicalURL.pathname.replace(/([^/]+)\/$/g, '$1') +
  canonicalURL.search +
  canonicalURL.hash;
const lang: Lang = content.lang || 'en';

changeLanguage(lang);
---

<HtmlDocument lang={lang} title={title} description={description}>
  <article class="main">
    <Navbar
      client:load
      lang={lang}
      urlMap={null}
      relativePageUrl={relativePageUrl}
      messages={getNavbarMessages()}
    />
    <SlantedHeader
      title={title}
      logoHref={navbarLinks[lang]?.home}
      logoLabel={'homepage'}
    />
    <BlogPostInfo
      createdAt={createdAt ?? ''}
      categories={categories}
      baseUrl={import.meta.env.BASE_URL}
    />
    <div class="main-content pt-0">
      <slot /><BlogPostComments class="comments-box" />
    </div>
    <footer><SocialLinksList /></footer>
  </article>
</HtmlDocument>
